using ComplianceService.Domain.Evaluation.ValueObjects;
using FluentAssertions;
using Xunit;

namespace ComplianceService.Domain.Tests.ValueObjects;

public class VulnerabilitySeverityTests
{
    [Theory]
    [InlineData("critical")]
    [InlineData("high")]
    [InlineData("medium")]
    [InlineData("low")]
    public void Create_WithValidSeverity_ShouldSucceed(string severity)
    {
        // Act
        var result = VulnerabilitySeverity.Create(severity);

        // Assert
        result.IsSuccess.Should().BeTrue();
        result.Value.Value.Should().Be(severity.ToLowerInvariant());
    }

    [Theory]
    [InlineData("CRITICAL")]
    [InlineData("High")]
    [InlineData("  medium  ")]
    public void Create_WithDifferentCasing_ShouldNormalize(string severity)
    {
        // Act
        var result = VulnerabilitySeverity.Create(severity);

        // Assert
        result.IsSuccess.Should().BeTrue();
        result.Value.Value.Should().Be(severity.Trim().ToLowerInvariant());
    }

    [Theory]
    [InlineData("")]
    [InlineData("  ")]
    [InlineData(null)]
    public void Create_WithEmptyValue_ShouldFail(string invalidSeverity)
    {
        // Act
        var result = VulnerabilitySeverity.Create(invalidSeverity);

        // Assert
        result.IsFailure.Should().BeTrue();
        result.Error.Should().Contain("cannot be empty");
    }

    [Theory]
    [InlineData("invalid")]
    [InlineData("info")]
    [InlineData("warning")]
    public void Create_WithInvalidSeverity_ShouldFail(string invalidSeverity)
    {
        // Act
        var result = VulnerabilitySeverity.Create(invalidSeverity);

        // Assert
        result.IsFailure.Should().BeTrue();
        result.Error.Should().Contain("Invalid severity");
    }

    [Fact]
    public void PredefinedValues_ShouldBeAccessible()
    {
        // Assert
        VulnerabilitySeverity.Critical.Value.Should().Be("critical");
        VulnerabilitySeverity.High.Value.Should().Be("high");
        VulnerabilitySeverity.Medium.Value.Should().Be("medium");
        VulnerabilitySeverity.Low.Value.Should().Be("low");
    }

    [Fact]
    public void IsCritical_WhenCritical_ShouldBeTrue()
    {
        // Arrange
        var severity = VulnerabilitySeverity.Create("critical").Value;

        // Assert
        severity.IsCritical.Should().BeTrue();
    }

    [Theory]
    [InlineData("high")]
    [InlineData("medium")]
    [InlineData("low")]
    public void IsCritical_WhenNotCritical_ShouldBeFalse(string severityValue)
    {
        // Arrange
        var severity = VulnerabilitySeverity.Create(severityValue).Value;

        // Assert
        severity.IsCritical.Should().BeFalse();
    }

    [Theory]
    [InlineData("critical")]
    [InlineData("high")]
    public void IsHighOrAbove_WhenHighOrCritical_ShouldBeTrue(string severityValue)
    {
        // Arrange
        var severity = VulnerabilitySeverity.Create(severityValue).Value;

        // Assert
        severity.IsHighOrAbove.Should().BeTrue();
    }

    [Theory]
    [InlineData("medium")]
    [InlineData("low")]
    public void IsHighOrAbove_WhenBelowHigh_ShouldBeFalse(string severityValue)
    {
        // Arrange
        var severity = VulnerabilitySeverity.Create(severityValue).Value;

        // Assert
        severity.IsHighOrAbove.Should().BeFalse();
    }

    [Theory]
    [InlineData("critical")]
    [InlineData("high")]
    [InlineData("medium")]
    public void IsMediumOrAbove_WhenMediumOrHigher_ShouldBeTrue(string severityValue)
    {
        // Arrange
        var severity = VulnerabilitySeverity.Create(severityValue).Value;

        // Assert
        severity.IsMediumOrAbove.Should().BeTrue();
    }

    [Fact]
    public void IsMediumOrAbove_WhenLow_ShouldBeFalse()
    {
        // Arrange
        var severity = VulnerabilitySeverity.Create("low").Value;

        // Assert
        severity.IsMediumOrAbove.Should().BeFalse();
    }

    [Fact]
    public void Equality_WithSameValue_ShouldBeEqual()
    {
        // Arrange
        var severity1 = VulnerabilitySeverity.Create("critical").Value;
        var severity2 = VulnerabilitySeverity.Create("critical").Value;

        // Assert
        severity1.Should().Be(severity2);
        (severity1 == severity2).Should().BeTrue();
    }

    [Fact]
    public void Equality_WithDifferentValue_ShouldNotBeEqual()
    {
        // Arrange
        var severity1 = VulnerabilitySeverity.Create("critical").Value;
        var severity2 = VulnerabilitySeverity.Create("high").Value;

        // Assert
        severity1.Should().NotBe(severity2);
        (severity1 != severity2).Should().BeTrue();
    }

    [Fact]
    public void ToString_ShouldReturnValue()
    {
        // Arrange
        var severity = VulnerabilitySeverity.Create("critical").Value;

        // Act
        var result = severity.ToString();

        // Assert
        result.Should().Be("critical");
    }
}

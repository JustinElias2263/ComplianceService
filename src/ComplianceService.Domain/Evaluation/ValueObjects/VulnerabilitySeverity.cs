using ComplianceService.Domain.Shared;

namespace ComplianceService.Domain.Evaluation.ValueObjects;

/// <summary>
/// Severity level of a vulnerability
/// </summary>
public sealed class VulnerabilitySeverity : ValueObject
{
    public string Value { get; }

    public static readonly VulnerabilitySeverity Critical = new("critical");
    public static readonly VulnerabilitySeverity High = new("high");
    public static readonly VulnerabilitySeverity Medium = new("medium");
    public static readonly VulnerabilitySeverity Low = new("low");

    private VulnerabilitySeverity(string value)
    {
        Value = value;
    }

    public static Result<VulnerabilitySeverity> Create(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
            return Result.Failure<VulnerabilitySeverity>("Severity cannot be empty");

        var normalized = value.Trim().ToLowerInvariant();

        return normalized switch
        {
            "critical" => Result.Success(Critical),
            "high" => Result.Success(High),
            "medium" => Result.Success(Medium),
            "low" => Result.Success(Low),
            _ => Result.Failure<VulnerabilitySeverity>($"Invalid severity: {value}")
        };
    }

    public bool IsCritical => Value == "critical";
    public bool IsHighOrAbove => Value is "critical" or "high";
    public bool IsMediumOrAbove => Value is "critical" or "high" or "medium";

    protected override IEnumerable<object?> GetEqualityComponents()
    {
        yield return Value;
    }

    public override string ToString() => Value;
}
